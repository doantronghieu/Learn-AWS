Finally, you need to learn

about CloudFormation capabilities.

So we have CAPABILITY_NAMED_IAM and CAPABILITY_IAM.

So they are capabilities you need to give to CloudFormation

whenever your CloudFormation template

is going to create or update IAM resources,

such as when you create a IAM user,

a role, a group, a policy, and so on,

through your CloudFormation templates.

So you specify NAMED_IAM if the resources are named,

otherwise, just CAPABILITY_IAM.

And the reason we do so

is that we want to explicitly acknowledge the fact

that CloudFormation is going to create IAM resources.

We have CAPABILITY_AUTO_EXPAND,

which is when your CloudFormation template

is including macro and nested stacks,

so stacks within stacks,

to perform dynamic transformations.

And in here, we're acknowledging that the template

may change before being deployed.

And finally,

if you obtain a InsufficientCapabilitiesException

while launching a template,

that means that the CloudFormation templates

was requiring capabilities,

but you haven't acknowledged them.

So, as a security measure, you need to redo the templates,

upload, and launch using, this time, these capabilities.

It's just an extra argument in your API call,

or a box to tick on your AWS console.

So here, under 3_capabilities.yaml,

I'm going to show you a CloudFormation template,

which actually has an IAM role being created.

And it's named, so there's a role name, MyCustomRoleName.

And it's using a managed policy,

which is the AmazonEC2FullAccess.

So we're dealing with IAM,

and so as such, we are creating some IAM roles.

And so therefore, if I create this stack

and upload the template file being the capabilities.yaml.

And I'll call this one DemoIAM.

Next.

And scroll all the way down.

Next.

And scroll all the way down.

As you can see, there is an acknowledgement

that says that you need to have this capability,

and it says, "Yes, I acknowledge the fact

that CloudFormation might create IAM resources

with custom names."

And so therefore, we are giving the capability

to CloudFormation to actually run this template

and to create this role.

If we don't do this,

then the submission is going to fail, as you can see.

But if we do do this, then now we're saying,

"Hey, I understand the risk of it.

I understand the fact that we are creating IAM resources

from within CloudFormation."

And that's it, that's all I want to show you.

All right, I will see you in the next lecture.